---
layout: post
title: weui 0.4.x 源码分析
category: 技术
tags: 前端
---

WeUI 是一套同微信原生视觉体验一致的基础样式库，由微信官方设计团队为微信内网页和微信小程序量身设计，令用户的使用感知更加统一。

分析这套源码, 可以让我们对手机web前端样式框架有一个整体的认识,也能帮助我们去给自己的前端代码做个最佳实践。

# 1 分析前必须掌握的知识

- Gulp: 前端自动化构建工具, 类似于Ant、Grunt
- Bower: 前端包管理工具, 类似Maven、Pip
- Less: 一门CSS 预处理语言，它扩展了CSS 语言，增加了变量、Mixin、函数等特性
- Node: 一个基于Chrome V8 引擎的JavaScript 运行环境。上面3个都需要Node的支持。

# 2 项目结构

```
weui
├── CHANGELOG.md
├── CONTRIBUTING.md 
├── README.md
├── package.json // Node环境依赖库
├── bower.json   // Bower打包描述
├── gulpfile.js  // Gulp自动化构建脚本
├── dist
│   ├── example   // 预处理后生成的范例
│   │   
│   └── style     // 预处理后生成的最终的 weui 样式代码, 以及min文件  
│       ├── weui.css
│       └── weui.min.css
└── src           // 源码文件夹
    ├── example   // 范例文件源码
    │   ├── example.js
    │   ├── example.less
    │   ├── fragment // 范例各个页面的代码
    │   │   ├── actionsheet.html
    │   │   ├── article.html
    │   │   ├── button.html
    │   │   ├── cell.html
    │   │   ├── dialog.html
    │   │   ├── home.html
    │   │   ├── icons.html
    │   │   ├── msg.html
    │   │   ├── navbar.html
    │   │   ├── panel.html
    │   │   ├── progress.html
    │   │   ├── searchbar.html
    │   │   ├── tab.html
    │   │   ├── tabbar.html
    │   │   └── toast.html
    │   ├── index.html
    │   ├── router.min.js // 范例路由文件
    │   └── zepto.min.js
    └── style       // weui样式源码文件夹
        ├── base
        │   ├── fn.less
        │   ├── mixin
        │   │   ├── mobile.less
        │   │   ├── setArrow.less
        │   │   ├── setChecked.less
        │   │   ├── setOnepx.less
        │   │   └── text.less
        │   ├── reset.less
        │   └── variable
        │       ├── global.less
        │       ├── monokai.less
        │       ├── weui_button.less
        │       ├── weui_cell.less
        │       ├── weui_grid.less
        │       ├── weui_msg.less
        │       └── weui_progress.less
        ├── icon
        │   ├── weui_font.less
        │   └── weui_icon_font.less
        ├── weui.less
        └── widget
            ├── weui_button
            │   ├── weui_btn_default.less
            │   ├── weui_btn_disabled.less
            │   ├── weui_btn_global.less
            │   ├── weui_btn_plain.less
            │   ├── weui_btn_primary.less
            │   ├── weui_btn_warn.less
            │   └── weui_button.less
            ├── weui_cell
            │   ├── weui_access.less
            │   ├── weui_cell_global.less
            │   ├── weui_check
            │   │   ├── weui_check_common.less
            │   │   ├── weui_checkbox.less
            │   │   └── weui_radio.less
            │   ├── weui_check.less
            │   ├── weui_form
            │   │   ├── weui_form_common.less
            │   │   ├── weui_select.less
            │   │   ├── weui_select_after.less
            │   │   ├── weui_select_before.less
            │   │   └── weui_vcode.less
            │   ├── weui_form.less
            │   ├── weui_switch.less
            │   └── weui_uploader.less
            ├── weui_grid
            │   └── weui_grid.less
            ├── weui_media_box
            │   └── weui_media_box.less
            ├── weui_page
            │   ├── weui_article.less
            │   └── weui_msg.less
            ├── weui_panel
            │   └── weui_panel.less
            ├── weui_progress
            │   └── weui_progress.less
            ├── weui_searchbar
            │   └── weui_searchbar.less
            ├── weui_tab
            │   ├── navbar.less
            │   ├── tabbar.less
            │   └── weui_tab.less
            └── weui_tips
                ├── weui_actionsheet.less
                ├── weui_dialog.less
                ├── weui_mask.less
                └── weui_toast.less
```

# 3 源码分析

## 3.1 寻找入口文件
一般从自动化构建脚本 `gulpfile.js` 中找入口文件。 查看原文件,可以发现下面两处代码。

```
/* line 20 - 47 */

gulp.task('build:style', function (){
    var banner = [
        '/*!',
        ' * WeUI v<%= pkg.version %> (<%= pkg.homepage %>)',
        ' * Copyright <%= new Date().getFullYear() %> Tencent, Inc.',
        ' * Licensed under the <%= pkg.license %> license',
        ' */',
        ''].join('\n');
    gulp.src('src/style/weui.less', option)
        .pipe(sourcemaps.init())
        .pipe(less().on('error', function (e) {
            console.error(e.message);
            this.emit('end');
        }))
        .pipe(postcss([autoprefixer(['iOS >= 7', 'Android >= 4.1'])]))
        .pipe(header(banner, { pkg : pkg } ))
        .pipe(sourcemaps.write())
        .pipe(gulp.dest(dist))
        .pipe(browserSync.reload({stream: true}))
        .pipe(nano({
            zindex: false,
            autoprefixer: false
        }))
        .pipe(rename(function (path) {
            path.basename += '.min';
        }))
        .pipe(gulp.dest(dist));
});

/* line 89 */ 
gulp.task('release', ['build:style', 'build:example']);
```

`release`任务依赖 `build:style`,  `build:style` 构建的源码文件是 `src/style/weui.less`。

查看 `src/style/weui.less`, 可看出所有的组成模块。

```
// reset样式, 保证跨浏览器的高度一致性。定义一些通用函数和变量。
@import "./base/reset";

// icon font
@import "./icon/weui_icon_font";


// button
@import "./widget/weui_button/weui_button";

// cell
@import "./widget/weui_cell/weui_cell_global";

@import "./widget/weui_cell/weui_access";
@import "./widget/weui_cell/weui_check";
@import "./widget/weui_cell/weui_form";
@import "./widget/weui_cell/weui_switch";
@import "./widget/weui_cell/weui_uploader";

// msg
@import "./widget/weui_page/weui_msg";

// article
@import "./widget/weui_page/weui_article";

// tab
@import "./widget/weui_tab/weui_tab";

// progress
@import "./widget/weui_progress/weui_progress";

// card
@import "./widget/weui_panel/weui_panel";

// media box
@import "./widget/weui_media_box/weui_media_box";

// grid
@import "./widget/weui_grid/weui_grid";

// tips
@import "./widget/weui_tips/weui_dialog";
@import "./widget/weui_tips/weui_toast";
@import "./widget/weui_tips/weui_mask";

//action sheet
@import "./widget/weui_tips/weui_actionsheet";

//searchbar
@import "./widget/weui_searchbar/weui_searchbar";
```

## 3.1 base模块
`style/base/` 目录下的文件有3个主要的文件(夹): reset、function、variable,
即reset样式、通用函数、常量定义。

### 3.1.1 全局函数

代码文件: `style/base/mixin/mobile.less`。 

主要有2个全局函数。用来设置高亮,和禁止选择文本。

```
// tapcolor
.setTapColor(@c:rgba(0,0,0,0)) {
    -webkit-tap-highlight-color: @c;  // 用户tap触摸后,显示的高亮色。 常用语按钮、行、链接、导航等
}


//user action
/*
这个属性，用来控制内容的可选择性。
这个功能,在本项目中都没有调用。

在之前是被用来保护网站的内容，不被用户复制和转载，从而保护资讯的版权，但是这样却对普通用户的用户体验造成了伤害，
而且，并不能真正的保护页面中的内容，这对前端开发人员来说，很容易搞定。
现在，HTML5蒸蒸日上，很多网站或者web app会使用到Drag and Drop技术，user-select正好在一些情境中可以用到。
*/
.no_select() {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
```

### 3.1.2 箭头函数

代码文件: `style/base/mixin/setArrow.less`。 

weui实现了两种类型的箭头, 每种都分上下左右4个方向。
但项目中只用到下面的第2种。

__1) 基于css2 盒模型实现的箭头__

效果及原理如下: 

![](/assets/images/weui/arrow_css2.jpg)

实现代码:

```
div {
    display: inline-block;
    width: 0;
    height: 0;
    border-width: 6px;
    border-style: dashed;
    border-color: transparent;
    border-right-width: 0;
    border-left-color: red;
    border-left-style: solid;
} 
```

__2) 基于css3的 `transform` 实现的尖括号箭头__

效果如下:

![](/assets/images/weui/arrow_css3.jpg)

实现代码:

```
div {
    display: inline-block;
    transform: rotate(45deg);
    height: 6px;
    width: 6px;
    border-width: 2px 2px 0 0;
    border-color: #C8C8CD;
    border-style: solid;
    position: relative;
    top: -1px;
    margin-left: .3em;
} 
```


### 3.1.3 打勾函数

代码文件: `style/base/mixin/setChecked.less`。 

设置选中函数,显示一个勾。原理同上面的箭头一样,只是其中1条边的长度是另一条的2倍。

```
// 一个相邻的勾
.setChecked(@c:#FFFFFF) {
    display: inline-block;
    content: '';
    width: 4px;
    height: 8px;
    border-bottom: 2px solid @c;
    border-right: 2px solid @c;
    transform: translate(0, 0) rotate(45deg);
}

// 绝对居中的勾
.setCheckedAbs(@c:#FFFFFF) {
    position: absolute;
    top: 50%;
    left: 50%;
    content: '';
    width: 4px;
    height: 8px;
    border-bottom: 2px solid @c;
    border-right: 2px solid @c;
    transform: translate(-50%, -65%) rotate(45deg);
}
```

### 3.1.4 设置1px的线的函数

上下左右共4条1px的线。

代码文件: `style/base/mixin/setOnepx.less`。 

在 iOS retina屏幕中,设置 1px 边框，实际显示 2px。 
为了得到真正的1px的线,有使用png图片和css3 scale等多种方式实现。
这里使用的便是css3 scale

```
.setTopLine(@c: #C7C7C7) {
    content: " ";
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 1px;
    border-top: 1px solid @c;
    color: @c;

    // 上面设置的div是1条2px的线, 下面缩小成1px。
    // 为什么不直接用1px呢? 原因是: 在 iOS retina屏幕中,设置 1px 边框，实际显示 2px。 所以借助css3的scale来实现。
    transform-origin: 0 0; // 设置变换元素的基点位置
    transform: scaleY(0.5); // 缩小1倍
}
```

### 3.1.5 文本处理函数

主要包括限制长度、限制行数、允许断句3个函数。

代码文件: `style/base/mixin/text.less`。 


```
//  限制长度
.ellipsis(@w:auto) {
    width: @w;          // 固定宽度
    overflow: hidden;   // 超出隐藏
    text-overflow: ellipsis;  // 超出使用...
    white-space: nowrap;    // 文本不换行
    word-wrap: normal;      // 只在允许的断字点换行（浏览器保持默认处理）
}

// 限制行数
.ellipsisLn(@line) {
    overflow: hidden;
    text-overflow: ellipsis;

    // -webkit-box 和 flex 是一样的。
    // display: -webkit-box; /* Chrome 4+, Safari 3.1, iOS Safari 3.2+ */
    // display: -moz-box; /* Firefox 17- */
    // display: -webkit-flex; /* Chrome 21+, Safari 6.1+, iOS Safari 7+, Opera 15/16 */
    // display: -moz-flex; /* Firefox 18+ */
    // display: -ms-flexbox; /* IE 10 */
    // display: flex; /* Chrome 29+, Firefox 22+, IE 11+, Opera 12.1/17/18, Android 4.4+ */
    display: -webkit-box;
    -webkit-box-orient: vertical; // 内部段落垂直分布
    -webkit-line-clamp: @line;  // 限制行数
}

// 允许断句
.text_wrap() {
    word-wrap:break-word;   // 允许浏览器在单词内进行断句
    word-break:break-all;   // 标明怎么样进行单词内的断句
}
```

### 3.1.6 全局变量

主要包括全局字体、字体颜色、间距等。

代码文件: `style/base/variable/global.less`。 

```
// font family
@sansFont:"Helvetica Neue",Helvetica,Arial,sans-serif;  // 无衬线字体
@serifFont:Georgia, "Times New Roman",Times,serif;      // 衬线字体
@wpFont:"Microsoft YaHei",sans-serif;                   // windows phone 上的字体
@bizFont:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif; // TODO: 这是什么鬼?
@globalFont:@sansFont;
@globalFontSize:14px;       //TODO: 浏览器默认的应该是16px,为什么要选择14px

// font color
@globalLinkColor: #61749B;
@globalDescColor: #B2B2B2;
@globalWarnColor: #E64340;
@globalNickNameColor: #576B95;
@globalTextColor: #888;
@globalTitleColor: #000;

//border
@globalBorderColor: #BCBAB6;

//arrow
@globalArrowColor: #C7C7CC;

//component
@itemActiveColor: #E4E4E4;

//page
@pageDefaultBackgroundColor:#EFEFF4;

// gap
@gap5:5px;
@gap10:10px;
@gap15:15px;
```

### 3.1.7 monokai配色方案变量

定义了monokai配色方案下背景色、各种高亮色的色值。
本项目中没有用到。

代码文件: `style/base/variable/monokai.less`。 

### 3.1.8 button变量
包含了按钮的大小、文件间距、各种状态下的字体颜色等变量。

代码文件: `style/base/variable/button.less`。 

### 3.1.9 cell变量
定义了cell的高度(44px)、背景色、border、间距,以及内部字体的大小、间距等。

代码文件: `style/base/variable/weui_cell.less`。 

### 3.1.10 grid变量
定义了grid网格布局下的 border颜色、字体大小、图标大小、以及网格数。

代码文件: `style/base/variable/weui_grid.less`。 

### 3.1.11 msg变量
定义了提示msg下的 标题、图标、文字之间的间距。

代码文件: `style/base/variable/weui_msg.less`。 

### 3.1.12 progress变量
定义了进度条progress的背景颜色、前景颜色、高度、关闭按钮的颜色。

代码文件: `style/base/variable/weui_progress.less`。

### 3.1.13 reset样式

设置了text-size-adjust: 关闭横屏时字体变大。

统一了font-family、line-height。

重置margin、padding都为0。

去除a、img的border,去除a的text-decoration。

其实现在流行的是用Normalize.css来规范样式。

代码文件: `style/base/reset.less`。

```
html {
    /*
     * iPhone 和 Android 的浏览器纵向 (Portrate mode) 和橫向 (Landscape mode) 模式皆有自动调整字体大小的功能。
     * 控制它的就是 CSS 中的 -webkit-text-size-adjust。
     * text-size-adjust 设为 none 或者 100% 关闭字体大小自动调整功能.
     * 之所以不使用 none 而是 100% 的原因是: none相当于禁用,则在手动放大页面时, 字体大小也不会改变。
     */
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
}

body {
    line-height: 1.6;       // 1.6 看起来比较舒适
    font-family: @sansFont; // TODO: 为什么选择这些字体呢?
}

* {
    margin: 0;              // 性能有点低,其实现在更常用的是使用Normalize.css
    padding: 0;
}

a img {
    border: 0;
}

a {
    text-decoration: none;   // 防止链接自动加下划线、点击后变色等
}
```

## 3.2 icon模块
weui使用了@font-face技术,自己开发了一套字体,共定义了15个图标。

![](/assets/images/weui/icon.jpg)

定义的内容包含:字体大小、颜色、与其他元素的间距等。

代码文件: `style/icon/weui_font.less`。

值得学习的是, weui的这种定义方式,把字体通用的样式(字体样式、间距、位置、大小等)放在了一起,不同的部分(content、颜色、部分大小)单独定义, 提高了可阅读性,降低了样式表大小。

```
@font-face {
    font-weight: normal;
    font-style: normal;
    font-family: "weui";
    // TODO: 很奇怪,为什么用 `application/octet-stream` 而不是常用的
    //src: url('//at.alicdn.com/t/font_1447319954_102335.eot'); /* IE9*/
    //src: url('//at.alicdn.com/t/font_1447319954_102335.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
    //     url('//at.alicdn.com/t/font_1447319954_102335.woff') format('woff'), /* chrome、firefox */
    //     url('//at.alicdn.com/t/font_1447319954_102335.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/
    //     url('//at.alicdn.com/t/font_1447319954_102335.svg#iconfont') format('svg'); /* iOS 4.1- */
    //
    src: url('data:application/octet-stream;base64,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') format('truetype');
}

// 与bootstrap相同, weui的icon通常作为伪元素的方式嵌入
[class^="weui_icon_"]:before, [class*=" weui_icon_"]:before {
    font-family: "weui";
    font-style: normal;
    font-weight: normal;
    speak: none; // 听觉样式表,不转成听觉内容

    display: inline-block;
    vertical-align: middle;
    text-decoration: inherit;
    width: 1em;
    margin-right: .2em; // 与右方的文字或者内容, 增加0.2em的边距
    text-align: center; // 居中
    /* opacity: .8; */

    /* For safety - reset parent styles, that can break glyph codes*/
    font-variant: normal;
    text-transform: none;

    /* fix buttons height, for twitter bootstrap */
    line-height: 1em;

    /* Animation center compensation - margins should be symmetric */
    /* remove if not needed */
    margin-left: .2em; // 与左方的文字或者内容, 增加0.2em的边距

    /* you can be more comfortable with increased icons size */
    /* font-size: 120%; */

    /* Uncomment for 3D effect */
    /* text-shadow: 1px 1px 1px rgba(127, 127, 127, 0.3); */
}
// 规定css样式与font-face的对应关系
.weui_icon_circle:before { content: "\EA01" } /* '' */
.weui_icon_download:before { content: "\EA02" } /* '' */
.weui_icon_info:before { content: "\EA03" } /* '' */
.weui_icon_safe_success:before { content: "\EA04" } /* '' */
.weui_icon_safe_warn:before { content: "\EA05" } /* '' */
.weui_icon_success:before { content: "\EA06" } /* '' */
.weui_icon_success_circle:before { content: "\EA07" } /* '' */
.weui_icon_success_no_circle:before { content: "\EA08" } /* '' */
.weui_icon_waiting:before { content: "\EA09" } /* '' */
.weui_icon_waiting_circle:before { content: "\EA0A" } /* '' */
.weui_icon_warn:before { content: "\EA0B" } /* '' */
.weui_icon_info_circle:before { content: "\EA0C" } /* '' */
.weui_icon_cancel:before { content: "\EA0D" } /* '' */
.weui_icon_search:before { content: "\EA0E" } /* '' */
.weui_icon_clear:before { content: "\EA0F" } /* '' */


:before {
    .weui_icon_success& {
        font-size: 23px;
        color: #09BB07;
    }
    .weui_icon_waiting& {
        font-size: 23px;
        color: #10AEFF;
    }
    .weui_icon_warn& {
        font-size: 23px;
        color: #F43530;
    }
    // ... 等等
}
:before {
    .weui_icon_msg& {
        font-size: 104px;
        .weui_icon_warn& {
            color: #F76260;
        }
    }
}

:before {
    .weui_icon_safe& {
        font-size: 104px;
    }
}
```

## 3.3 button模块
和bootstrap一样,我们需要定义一套按钮, 

分别表示默认、主要、警告3种类型, 2种状态:可用和禁用状态, 大小:大中小3种。 

所以可以组合成 3 \* 2 \* 3=18 种不同的样式。

![](/assets/images/weui/button.jpg)

### 3.3.1 按钮通用样式

代码文件: `style/widget/weui_button/weui_btn_global.less`

```
@import "../../base/fn";

.weui_btn {
    position: relative;  // 相对定位
    display: block;

    margin-left: auto;
    margin-right: auto;

    padding-left: 14px; // 内部间距14px
    padding-right: 14px;
    box-sizing: border-box;

    font-size: @weuiBtnFontSize; // 按钮字体18px,比body的14px大一些,显得比较突出
    text-align: center;          // 文字居中,如果是a标签,不要text-decoration
    text-decoration: none;
    color: @weuiBtnFontColor;
    line-height: unit(@weuiBtnHeight/@weuiBtnFontSize); // 看起来要与按钮一样高, 才显得垂直居中
    border-radius: @weuiBtnBorderRadius;                // 5px的圆角

    .setTapColor();
    overflow: hidden;
    &:after {                                           // 给按钮套一层边框, 增加立体效果。  TODO: 为什么不直接用border呢?
        content: " ";

        width: 200%;                                    // 和生成1px的线,用的相同的伎俩。 先设置2倍大小,然后再scale到一半
        height: 200%;
        position: absolute;
        border-radius: @weuiBtnBorderRadius*2;
        border: 1px solid rgba(0, 0, 0, .2);
        transform: scale(.5);
        transform-origin: 0 0;

        top: 0;
        left: 0;
        box-sizing: border-box;
    }

    &.weui_btn_inline {
        display: inline-block;
    }
}
```

### 3.3.2 设置不同大小按钮的差异, 以及他们的布局

代码文件: `style/widget/weui_button/weui_button.less`

```
@import "../../base/fn";
// 存在样式优先级的问题，故这里对其他weui_btn的引用放在底部
// 主要是button.weui_btn在weui_btn_plain下重写border-width

.weui_btn {
    &.weui_btn_mini {
        line-height: @weuiBtnMiniHeight;
        font-size: @weuiBtnMiniFontSize;
        padding: 0 .75em;
        display: inline-block;
    }
}

button, input {
    &.weui_btn {
        width: 100%;                // 按钮默认占满父元素
        border-width: 0;
        outline: 0;
        -webkit-appearance: none;   // 禁用原生样式
        &:focus {
            outline: 0;             // 选中时不要加outline
        }
    }
    &.weui_btn_inline,&.weui_btn_mini {
        width: auto;                // inline、mini的button宽度随文字宽度变动
    }
}

/*gap between btn*/
.weui_btn + .weui_btn {
    margin-top: @weuiBtnDefaultGap; // 相邻的button,在垂直上保持一定间距
}

.weui_btn.weui_btn_inline + .weui_btn.weui_btn_inline { // 相邻的inline、mini的button,在水平上保持一定间距
    margin-top: auto;
    margin-left: @weuiBtnDefaultGap;
}

.weui_btn_area {
    margin: @weuiCellsMarginTop @weuiBtnDefaultGap .3em;    // button area 要距离其它部分稍微远一点,看起来比较舒服
    &.weui_btn_area_inline {
        display: flex;                                      // area inline 采用flex布局
        .weui_btn {
            margin-top: auto;
            margin-right: @weuiBtnDefaultGap;               // 按钮之间保证一点间距
            width: 100%;
            flex: 1;                                        // 按钮大小一样
            &:last-child {
                margin-right: 0;                            // 消除最后一个button的右间距, 保证所有button看起来居中
            }
        }
    }
}

@import "weui_btn_global";
@import "weui_btn_default";
@import "weui_btn_primary";
@import "weui_btn_warn";
@import "weui_btn_disabled";
@import "weui_btn_plain";
```

### 3.3.3 定义不同功能类型的按钮

主要有default、primary、warn 3种类型。

代码文件: `style/widget/weui_button/weui_btn_default.less`

```
@import "../../base/fn";

.weui_btn_default {
    background-color: @weuiBtnDefaultBg;  // 默认背景色白色
    color: @weuiBtnDefaultFontColor;      // 默认前景色黑色
    // not(.weui_btn_disabled) 是为了在button禁用时, 没有下面的效果
    &:not(.weui_btn_disabled):visited {   // 访问过后,前景色不变
        color: @weuiBtnDefaultFontColor;
    }
    &:not(.weui_btn_disabled):active {    // 当被按下按住的时候, 白色背景并暗, 黑色前景色变灰, 给用户一个反馈
        color: @weuiBtnDefaultActiveFontColor;
        background-color: @weuiBtnDefaultActiveBg;
    }
}
```

代码文件: `style/widget/weui_button/weui_btn_primary.less`

```
@import "../../base/fn";

.weui_btn_primary {
    background-color: @weuiBtnPrimaryBg;  // 背景绿色, 前景色默认也是白色, 在weui_btn_global已经定义过了
    &:not(.weui_btn_disabled):visited {
        color: @weuiBtnFontColor;         // 前景色是白色字体, 不变
    }
    &:not(.weui_btn_disabled):active {    // 按下时, 背景色和字体都变暗
        color: @weuiBtnActiveFontColor;
        background-color: @weuiBtnPrimaryActiveBg;
    }
}

```

代码文件: `style/widget/weui_button/weui_btn_warn.less`

```
@import "../../base/fn";

.weui_btn_warn {
    background-color: @weuiBtnWarnBg;           // 警告,用红色背景, 字体默认是白色
    &:not(.weui_btn_disabled):visited {
        color: @weuiBtnFontColor;
    }
    &:not(.weui_btn_disabled):active {          // 按下时, 按钮背景变暗红色, 字体变灰
        color: @weuiBtnActiveFontColor;
        background-color: @weuiBtnWarnActiveBg;
    }
}

```

### 3.3.4 定义空心按钮

主要有default、primary 2 种类型的空心按钮。

代码文件: `style/widget/weui_button/weui_btn_plain.less`

```
@import "../../base/fn";
/* 定义了default 和 primary两种类型的空心按钮 */
.weui_btn_plain_primary {
    color: @weuiBtnPrimaryBg;
    border: 1px solid @weuiBtnPrimaryBg;        // 多了一个边框
    button&, input& {
        border-width: 1px;
        background-color: transparent;          // 背景色透明
    }
    &:active {
        border-color: @weuiBtnPrimaryActiveBg;  // 按下时变暗绿色
    }
    &:after {
        border-width: 0;                        // 禁掉按钮的after边框效果, 防止与自身的border重叠
    }
}

.weui_btn_plain_default {
    color: #5A5A5A;
    border: 1px solid #5A5A5A;
    button&, input& {
        border-width: 1px;
        background-color: transparent;
    }                                        // TODO: 此处应该有:active才对呀,要不然按下没反应
    &:after {
        border-width: 0;
    }
}
```

### 3.3.5 处理按钮的disabled状态

主要就是改变前景色和背景色。

代码文件: `style/widget/weui_button/weui_btn_disabled.less`

```
@import "../../base/fn";

.weui_btn_disabled {
    color: @weuiBtnDisabledFontColor;     // 禁用状态下按钮文本颜色变灰变暗
    &.weui_btn_default {
        color: @weuiBtnDefaultDisabledFontColor;   // default状态下的按钮,因为背景色已经是灰色的了, 变灰会导致看不见,所以稍微白一些
    }
}
```

## 3.4 cell模块
在weui中, 信息基本都是以一栏一栏(cell)的形式呈现, 功能相近的一栏则组成一组(cells), 组中有头部title和底部tips。



### 3.4.1 cell布局样式

cell的布局结构如下所示:

```
weui_cells_title
weui_cells
    weui_cell
        weui_cell_hd weui_cell_bd weui_cell_ft
    weui_cell
        ...
weui_cells_tips
```

效果图:

![](/assets/images/weui/weui_cell_global.png)

代码文件: `style/widget/weui_cell/weui_cell_global.less`

```
@import "../../base/fn";

/* 组织结构规则是
weui_cells_title
weui_cells
    weui_cell
        weui_cell_hd weui_cell_bd weui_cell_ft
    weui_cell
        ...
weui_cells_tips

*/

.weui_cell {
    // onepx
    position: relative;
    &:before {
        .setTopLine(@weuiCellBorderColor);   // 设置顶部的一条线条,就可以了, 层叠在一起,看起来就都有上下2条分割线
        left: @weuiCellGapH;                 // 对齐
    }
    &:first-child {         // weui_cells中有top和bottom 2条线, 为了不重叠, 第1条线不绘制
        &:before {
            display: none;
        }
    }
}

/* cell组 */
.weui_cells {
    margin-top: @weuiCellsMarginTop;     // 使用margin-top保证组与组之间保持一定的间距
    background-color: @weuiCellBg;       // 背景色是白色
    line-height: @weuiCellLineHeight;    // 设置合适的line-height,保证内部元素垂直居中
    font-size: @weuiCellFontSize; //cell中间有效高度23px=17px*line-height，跟客户端默认图标尺寸一致

    overflow: hidden; //因为每个cell的border使用before元素left搞的，ie下伪元素的containing block估计跟标准不同，在cell上用oh不生效

    // onepx ,  设置上下cells组分割线
    position: relative;
    &:before {
        .setTopLine(@weuiCellBorderColor);
    }
    &:after {
        .setBottomLine(@weuiCellBorderColor);
    }
}
/* cell组前面的title */
.weui_cells_title {
    margin-top: .77em; // 15px - 行高  ,距离上面 稍微大一些,下面小一些, 比较容易分清和那个cells是一组
    margin-bottom: .3em; // 8px - 行高
    padding-left: @weuiCellGapH;        // 与cells组左右内边距一致, 对齐好看
    padding-right: @weuiCellGapH;
    color: @globalTextColor;
    font-size: @weuiCellTipsFontSize;

    & + .weui_cells {   // 紧接相邻的cells, margin-top设为0
        margin-top: 0;
    }
}
// cell组后面的底部说明文字
.weui_cells_tips {
    margin-top: .3em; // 8px - 行高  ,靠近上面的cells
    color: @globalTextColor;     // 灰色字,表示说明
    padding-left: @weuiCellGapH;
    padding-right: @weuiCellGapH;
    font-size: @weuiCellTipsFontSize;
}

.weui_cell {
    padding: @weuiCellGapV @weuiCellGapH;
    position: relative; //这个是为了兼容cells容器onepx方案被before挡住而做的
    display: flex;          // cell是用flex布局做的
    align-items: center;
}

.weui_cell_ft {
    text-align: right;      // 靠右, 有多长显示多长
    color: @globalTextColor;
}

.weui_cell_primary {
    flex: 1;       // .weui_cell_bd.weui_cell_primary 表示占满剩余空间
}
```

### 3.4.2 可点击的cell: weui_cell_acess样式

最右边带箭头的cell栏, 表示这一栏点击进去之后有内容。 

效果:

![](/assets/images/weui/weui_cell_acess.png)

代码文件: `style/widget/weui_cell/weui_access.less`

```
@import "../../base/fn";

.weui_cells_access {
    .weui_cell:not(.no_access) {
        // 在cell_access和其它类型的cell混着用的场景下，其它cell要加no_access，避免有点击态
        .setTapColor;           // tab有颜色反应, 和下面的active是类似的
        &:active {              // 按下后,背景色加深,给用户一个反馈
            background-color: #ECECEC;
        }
    }
    a.weui_cell {
        color: inherit;
    }
    .weui_cell_ft {             // 在这一栏的最右边,生成一个向右的箭头,表示这一栏点进去还有内容
        &:after {
            content: " ";
            .setArrow_Wap(right, 6px, #C8C8CD, 2px);
            top: -1px;
            margin-left:.3em;
        }
    }
}
```

### 3.4.3 单选和多选框: weui_check样式 

效果:

![](/assets/images/weui/weui_cell_check.png)

代码文件: `style/widget/weui_cell/weui_check.less`

该文件包含3部分,通用、单选、多选, 我们依次介绍。

```
@import "../../base/fn";
@import "./weui_check/weui_check_common";
@import "./weui_check/weui_radio";
@import "./weui_check/weui_checkbox";
```

#### 3.4.3.1 选择框通用样式

隐藏浏览器原生效果, 使用自定义的按钮代替。 浏览器原生效果如下所示:

![](/assets/images/weui/weui_cell_check_origin.png)

代码文件: `style/widget/weui_cell/weui_check/weui_check_common.less`

```
@import "../../../base/fn";

.weui_check_label {
    .setTapColor();     // 触摸高亮
}

.weui_check{            // 用-9999em隐藏浏览器原生的radio和checkbox效果
    position: absolute;
    left: -9999em;
}
```


#### 3.4.3.2 radio样式

代码文件: `style/widget/weui_cell/weui_check/weui_radio.less`

```
@import "../../../base/fn";

// method2 accessbility
.weui_cells_radio{
    .weui_cell_ft {                             // 单选按钮位于footer
        padding-left: @weuiCellInnerGapH;       // 选择按钮,要与前面的文字间隔一些距离
    }
    .weui_cell {                                // 按下时有高亮效果
        &:active {
            background-color: #ECECEC;
        }
    }
}
.weui_check {
    // radio
    .weui_cells_radio & {                   // 未选中时,weui_icon_checked不显示任何东西
        &:checked {
            & + .weui_icon_checked {        // 选中时, weui_icon_checked显示绿色的打钩按钮
                &:before {
                    display: block;
                    content: '\EA08';
                    color: #09BB07;
                    font-size: 16px;
                }
            }
        }
    }
}
```

#### 3.4.3.3 check样式

代码文件: `style/widget/weui_cell/weui_check/weui_checkbox.less`

```
@import "../../../base/fn";

.weui_cells_checkbox {
    .weui_cell_hd {                             // 复选框位于header
        padding-right: @weuiCellInnerGapH;      // 和右边的文字保持一定的距离
    }
    .weui_cell {                                // 按下要有高亮效果
        &:active {
            background-color: #ECECEC;
        }
    }
    .weui_icon_checked {                        // 未选中时,显示未打钩的空心圆,表示可以选择
        &:before {
            content: '\EA01';
            color: #C9C9C9;
            font-size: 23px;
            display: block;
        }
    }
}

// method2 accessbility
.weui_check {
    // checkbox
    .weui_cells_checkbox & {
        &:checked {                             // 选中时,显示打钩的实心圆,表示已选择
            & + .weui_icon_checked {
                &:before {
                    content: '\EA06';
                    color: #09BB07;
                }
            }
        }
    }
}
```

### 3.4.4 常用表单: lable、输入框、提示信息以及下拉框等

代码文件: `style/widget/weui_cell/weui_form.less`

```
@import "../../base/fn";
@import "./weui_form/weui_form_common";
@import "./weui_form/weui_select";
@import "./weui_form/weui_select_before";
@import "./weui_form/weui_select_after";
@import "./weui_form/weui_vcode";
```

包含了多个文件,我们依次分析。

### 3.4.4.1 常用表单: lable、输入框、提示信息

代码文件: `style/widget/weui_cell/weui_form/weui_form_common.less`

```
@import "../../../base/fn";

.weui_label{                // label 固定宽度, 超出文字自动缩略
    display:block;
    width:@weuiCellLabelWidth;
    .text_wrap();
}
.weui_input {
    width: 100%;            // 输入框占满整行
    border: 0;              // 去掉边框效果,看起来比较整洁
    outline: 0;             // 去掉外框
    -webkit-appearance: none;   // 禁用原生效果
    background-color: transparent;
    font-size: inherit;
    color: inherit;
    height: unit(@weuiCellLineHeight, em); //  看起来居中
    line-height: @weuiCellLineHeight;

    // hides the spin-button
    &::-webkit-outer-spin-button, &::-webkit-inner-spin-button{             // spin-button 是浏览器给input框加上的原生样式,如`type=number`会加上上下加减按钮, 我们需要禁用。
        -webkit-appearance: none;
        margin: 0;
    }
}
.weui_textarea {                    // 去掉textarea的一切边框效果
    display: block;
    border: 0;
    resize: none;
    width: 100%;
    color: inherit;
    font-size: 1em;
    line-height: inherit;
    outline: 0;
}

.weui_textarea_counter{             // textarea的下一行最右边显示字数统计
    color: @globalDescColor;
    text-align: right;
    .weui_cell_warn &{              // 可用红色来表示警告
        color: @globalWarnColor;
    }
}

.weui_toptips {                     // 在屏幕顶部中央显示的提示信息
    display:none;
    position: fixed;
    -webkit-transform: translateZ(0);
    width: 100%;
    top: 0;
    line-height: 2.3;
    font-size:14px;
    text-align: center;
    color: #FFF;
    z-index: 50000;                 // 确保在最上面
    &.weui_warn {                   // 红色表示警告或者报错
        background-color: @globalWarnColor;
    }
}
.weui_cells_form {
    .weui_cell_warn{                // cell warn时, cell内的文字变红, 并且warn icon显示
        color:@globalWarnColor;
        .weui_icon_warn{display:inline-block;}
    }
    .weui_cell_ft{font-size:0;}
    .weui_icon_warn{            // warn icon默认不显示
        display:none;
    }
    input, textarea, label[for]{        // 高亮色是白色,和背景色相同,相当于没有效果
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }
}

```

spin-button 是浏览器给input框加上的原生样式,如`type=number`会加上上下加减按钮, 我们需要禁用。 对比效果如下所示:
  
![](/assets/images/weui/weui_cell_spin_button.png)


### 3.4.4.2 下拉框

效果如下图: 

![](/assets/images/weui/weui_cell_select.jpg)

包含3中情况,下拉框在前面、中间、后面。 

代码文件: `style/widget/weui_cell/weui_form/weui_select.less`

```
@import "../../../base/fn";

.weui_cell_select {
    padding: 0;
    .weui_select {              // 距离右端30px, 防止遮挡箭头
        padding-right: 30px;
    }
    .weui_access_icon {

    }
    .weui_cell_bd{             // 添加一个箭头,表示这里可以下拉
        &:after{
            content: " ";
            .setArrow_Wap(right, 6px, #C8C8CD, 2px);

            position: absolute;
            top: 50%;
            right: @weuiCellGapH;
            margin-top: -3px;
        }
    }
}

.weui_select {
    -webkit-appearance: none;       // 禁用select的原生样式
    border: 0;                      // 去掉边框和外框,看起来简洁
    outline: 0;
    background-color: transparent;
    width: 100%;                     // 占满整行
    font-size: inherit;
    height: @weuiCellHeight;         // 垂直居中
    line-height: @weuiCellHeight;
    position: relative;
    z-index: 1;
    padding-left: @weuiCellGapH;   
}

```

代码文件: `style/widget/weui_cell/weui_form/weui_select_before.less`

```
@import "../../../base/fn";
@import "./weui_select";

.weui_select_before {
    padding-right:@weuiCellGapH;
    .weui_select {
        width:@weuiCellLabelWidth;
        box-sizing: border-box;
    }
    .weui_cell_hd {         //select before中的header, 如上图中的+86区号选择
        position:relative;
        &:after {           // 右边需要加一条分割线
            .setRightLine(@weuiCellBorderColor);
        }
        &:before{           // 右边加一个箭头
            content: " ";
            .setArrow_Wap(right, 6px, #C8C8CD, 2px);

            position: absolute;
            top: 50%;
            right: @weuiCellGapH;
            margin-top: -3px;
        }
    }
    .weui_cell_bd {    // select before中的body, 不需要加箭头, 因为已经在header展示了
        padding-left:@weuiCellGapH;
        &:after{
            display:none;
        }
    }
}
```

代码文件: `style/widget/weui_cell/weui_form/weui_select_after.less`

```
@import "../../../base/fn";
@import "./weui_select";

.weui_select_after {
    padding-left:@weuiCellGapH;   // select after, 箭头已经有了,只要保证对齐就行
    .weui_select {
        padding-left:0;
    }
}
```


### 3.4.4.3 验证码

效果如下图: 

![](/assets/images/weui/weui_cell_vcode.png)

代码文件: `style/widget/weui_cell/weui_form/weui_vcode.less`

```
@import "../../../base/fn";

.weui_vcode {
    padding-top: 0;         // 靠右对齐
    padding-right: 0;
    padding-bottom: 0;
    .weui_cell_ft {
        img {
            margin-left: 5px;       // 居中,并且和左边保持一点距离
            height: @weuiCellHeight;
            vertical-align: middle;
        }
    }
}
```

### 3.4.5 开关: switch样式

处理底座、按钮、底座背景 3者的关系, 用checkbox实现一个switch。

效果:

![](/assets/images/weui/weui_cell_switch.png)

代码文件: `style/widget/weui_cell/weui_switch.less`

```
@import "../../base/fn";
@weuiSwitchHeight: 32px;
.weui_cell_switch{                  // 保证开关是居中的
    padding-top: (@weuiCellHeight - @weuiSwitchHeight) / 2;
    padding-bottom: (@weuiCellHeight - @weuiSwitchHeight) / 2;
}
.weui_switch{                       // 实际上是一个checkbox
    appearance: none;               // 禁用原生样式
    position: relative;
    width: 52px;
    height: @weuiSwitchHeight;
    border: 1px solid #DFDFDF;      // 加一个边框和圆角、背景色, 看起来比较像开关的底座
    outline: 0;
    border-radius: 16px;
    box-sizing: border-box;
    background: #DFDFDF;            // 未选中时, 边框和背景都是灰色
    background-color: #DFDFDF;
    transition: background-color .1s, border .1s;   // 开关移动过程, 背景色和边框色都渐变, 看起来有动的感觉
    &:before{                                       // before 是底座白色背景, 用来处理背景动态效果
        content: " ";
        position: absolute;
        top: 0;
        left: 0;
        width: 50px;
        height: @weuiSwitchHeight - 2;
        border-radius: 15px;
        background-color: #FDFDFD;
        transition:transform .3s;
        transition:transform .35s cubic-bezier(0.45, 1, 0.4, 1);
    }
    &:after{                                        // after是圆形按钮
        content: " ";
        position: absolute;
        top: 0;
        left: 0;
        width: @weuiSwitchHeight - 2;               // 圆形, 比底座稍微小一点, 防止边界重叠,不好区分
        height: @weuiSwitchHeight - 2;
        border-radius: 15px;
        background-color: #FFFFFF;                  // 空心
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);    // 来一点阴影,显得立体
        transition:transform .3s;
        box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        transition:transform .35s cubic-bezier(0.4, 0.4, 0.25, 1.35); // 弹回效果, 比较有动感
    }

    &:checked{
        border-color: #04BE02;          // 选中后, 边框和背景变为绿色
        background-color: #04BE02;
        &:before{                       // 选中后,白色背景逐渐消失, 有动态效果
            transform: scale(0);
        }
        &:after{
            transform: translateX(20px); // 选中后, 按钮往右移动20px。 左边关, 右边开。
        }
    }
}
```

### 3.4.6 文件上传: uploader样式

效果:

![](/assets/images/weui/weui_cell_uploader.png)

代码文件: `style/widget/weui_cell/weui_uploader.less`

```
@import "../../base/fn";

/* 布局结构
weui_uploader
    weui_uploader_hd
        hd bd ft
    weui_uploader_bd
        ul.weui_uploader_files
            li.weui_uploader_file
            li.weui_uploader_file
            ...
        weui_uploader_input_wrp
            input.weui_uploader_input

*/

@weuiUploaderBorderColor:#D9D9D9;
@weuiUploaderActiveBorderColor:#999999;
@weuiUploaderFileSpacing: 9px;
@weuiUploaderSize: 79px;
@weuiUploaderBorderWidth: 1px;

.weui_uploader{}
.weui_uploader_hd{          // header 文字描述信息
    padding-top: 0;
    padding-right: 0;
    padding-left: 0;
    .weui_cell_ft{
        font-size: 1em;
    }
}
.weui_uploader_bd{          // 图片区域
    margin-bottom: @weuiCellGapH - (@weuiCellGapV + @weuiUploaderFileSpacing);
    margin-right: -@weuiUploaderFileSpacing;    // 保证files整体看起来居中
    overflow: hidden;
}

.weui_uploader_files{
    list-style: none;    // 禁用ul原生样式
}
.weui_uploader_file{    // 使用float布局,并设置右边距和下边距,保证对齐
    float: left;
    margin-right: @weuiUploaderFileSpacing;
    margin-bottom: @weuiUploaderFileSpacing;
    width: @weuiUploaderSize;
    height: @weuiUploaderSize;
    background: no-repeat center center;   // 背景图片占满,可预览
    background-size: cover;
}
.weui_uploader_status{      // 图片中央的上传进度或提示图标
    position: relative;
    &:before{               // 先在图片上加一个半透明的灰色蒙版
        content: " ";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0, 0, 0, .5);
    }
    .weui_uploader_status_content{  // 然后在蒙版中间,显示内容
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #FFFFFF;
    }
    .weui_icon_warn{                // 或者显示图标
        display: block;
    }
}

.weui_uploader_input_wrp{           // 添加图片的按钮
    float:left;
    position: relative;
    margin-right: @weuiUploaderFileSpacing;
    margin-bottom: @weuiUploaderFileSpacing;
    width: @weuiUploaderSize - @weuiUploaderBorderWidth * 2;
    height: @weuiUploaderSize - @weuiUploaderBorderWidth * 2;
    border: @weuiUploaderBorderWidth solid @weuiUploaderBorderColor;  // 加一个边框
    &:before, &:after{              // before和after构造 + 按钮
        content: " ";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: @weuiUploaderBorderColor;
    }
    &:before{
        width: @weuiUploaderBorderWidth + 1;
        height: @weuiUploaderSize / 2;
    }
    &:after{
        width: @weuiUploaderSize / 2;
        height: @weuiUploaderBorderWidth + 1;
    }
    &:active{                   // 按下时,边框和+按钮,颜色变暗, 让用户感知改变
        border-color: @weuiUploaderActiveBorderColor;
        &:before, &:after{
            background-color: @weuiUploaderActiveBorderColor;
        }
    }
}
.weui_uploader_input{           // 其实这是一个checkbox      
    position: absolute;
    z-index: 1;
    top: 0;
    left: 0;
    width: 100%;                // 铺满weui_uploader_input_wrp, 使整体点触有效
    height: 100%;
    opacity: 0;                 // 用opcacity=0,不显示按钮,但是功能能用
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);      // 禁用原生的高亮效果
}
```

## 3.5 grid模块
网格布局, 用float实现布局, 用before实现边框。

效果:

![](/assets/images/weui/weui_grids.png)

代码文件: `style/widget/weui_grid/weui_grid.less`

```
@import "../../base/fn";

/* 网格布局
weui_grids
    weui_grid
        weui_grid_icon
        weui_grid_label
    weui_grid
    ...

*/
.weui_grids {
    position: relative;
    overflow: hidden;

    &:before {      // grids的上边框
        content: '';
        position: absolute;
        box-sizing: border-box;
        width: 200%;
        height: 200%;
        left: 0;
        top: 0;
        border: 1px solid @weuiGridBorderColor;
        transform-origin: 0 0;
        transform: scale(.5);
    }
}

.weui_grid {
    position: relative;
    float: left;                // float布局, 保证可以放置不定数量个
    padding: 20px 10px;         // 保证合适的内间距,看起来比较整齐
    width: 100% / @weuiGridColumnCount;     // 平分宽度
    box-sizing: border-box;

    &:before {                 // 每个grid的 下边框 和 右边框
        content: '';
        position: absolute;
        box-sizing: border-box;
        width: 200%;
        height: 200%;
        left: 0;
        top: 0;
        border-bottom: 1px solid @weuiGridBorderColor;
        border-right: 1px solid @weuiGridBorderColor;
        transform-origin: 0 0;
        transform: scale(.5);
    }

    &:nth-child(3n) {       // 最右边的一列grid没有右边框
        &:before {
            border-right-width: 0;
        }
    }

    &:active {              // 按下时背景变暗, 让用户感知到点击
        background-color: @itemActiveColor;
    }
}

.weui_grid_icon {                   // icon 固定宽度, 水平居中
    width: @weuiGridIconSize;
    height: @weuiGridIconSize;
    margin: 0 auto;

    img {
        display: block;
        width: 100%;
        height: 100%;
    }

    & + .weui_grid_label {         // label 与icon保证一定的距离
        margin-top: 5px;
    }
}

.weui_grid_label {                  // 定义label:文字居中,字体大小和颜色
    display: block;
    text-align: center;
    color: @globalTitleColor;
    font-size: @weuiGridFontSize;
}
```

## 3.6 media_box模块
共4种图文组合效果

效果:

![](/assets/images/weui/weui_media_box.jpg)

代码文件: `style/widget/weui_grid/weui_media_box.less`

```
@import "../../base/fn";

@lineColor: #E5E5E5;
@grayColor: #999999;

/* 图文组合结构

1) 带图大标题
weui_media_box.weui_media_appmsg
    weui_media_hd
        img
    weui_media_bd
        weui_media_title
        weui_media_desc

2) 不带图,大标题
weui_media_box.weui_media_text
    weui_media_title
    weui_media_desc

3) 带小图和标题
weui_media_box.weui_media_small_appmsg
    weui_cells
        weui_cell
        weui_cell
        ...
4) 带info
weui_media_box.weui_media_text
    weui_media_title
    weui_media_desc
    weui_media_info
        weui_media_info_meta weui_media_info_meta weui_media_info_meta_extra
*/

.weui_media_box {
    padding: 15px;                  // 略大间距,显得大气
    position: relative;
    &:before {                      // topline 保证和文本对齐
        .setTopLine(@lineColor);
        left: 15px;
    }
    &:first-child {                 // 第一个media_box不要topline
                                    // 因为在和panel组合使用的时候, weui_panel_hd有bottomline保证了box的topline,
                                    // weui_panel的bottomline保证了box的bottomline。
        &:before {
            display: none
        }
    }

    a&{                             // 如果整体是a标签,则需要强制设置color和高亮色
        color:#000000;
        .setTapColor;
        &:active{
            background-color:#ECECEC;
        }
    }

    .weui_media_title {             // 大标题, 超出则用省略号
        font-weight: 400;
        font-size: 17px;
        .ellipsis();
        word-wrap: break-word;
        word-break: break-all;
    }
    .weui_media_desc {              // 略小字体, 灰色, 限制在2行, 超出则用省略号, 保证不那么显眼
        color: @grayColor;
        font-size: 13px;
        line-height: 1.2;
        .ellipsisLn(2);
    }

    &.weui_media_text {             // 2)和4)不带图的box, title和desc的间距要稍微大一点
        .weui_media_title {
            margin-bottom: 8px;
        }
        .weui_media_info {          // box footer信息
            margin-top: 15px;
            padding-bottom: 5px;
            font-size: 13px;
            color: #CECECE;
            line-height: 1em;
            list-style: none;
            overflow: hidden;
        }
        .weui_media_info_meta {     // 内部信息用float布局, 用padding-right保证间隔
            float: left;
            padding-right: 1em;
            &.weui_media_info_meta_extra {  // 在左边增加一个竖线分割
                padding-left: 1em;
                border-left: 1px solid #CECECE;
            }
        }

    }
    &.weui_media_appmsg {           // 1) 带大图的box, 使用flex布局
        display: flex;
        align-items: center;
        .weui_media_hd {            // header, 与右边的文字保持0.8em的距离
            margin-right: .8em;
            width: 60px;
            height: 60px;
            line-height: 60px;
            text-align: center;
        }
        .weui_media_appmsg_thumb {  // avatar图, 全占
            width: 100%;
            max-height: 100%;
            vertical-align: top;
        }
        .weui_media_bd {                // 剩余空间全部给body
            flex: 1;
            min-width: 0;               // TODO:这有什么用?
        }
    }
    &.weui_media_small_appmsg {
        padding: 0;
        .weui_cells {
            margin-top: 0;
            &:before {                  // 去掉weui_cells 自带的topline, 改由panel保证
                display: none;
            }
        }
        .weui_cells_access {
        }
    }
}
```


## 3.7 page模块: article 和 msg
文章正文内容 及 消息通知

### 3.7.1 文章正文内容: article

效果:

![](/assets/images/weui/weui_article.png)

代码文件: `style/widget/weui_page/weui_article.less`

```
@import "../../base/fn";

.weui_article {
    padding: 20px 15px;         // 统统都是左右内边距15px,保证对齐
    font-size: 15px;            // TODO: 为什么不是14px?
    section {
        margin-bottom: 1.5em;
    }
    h1 {                        // 每种标题不一样的地方是: font-size、margin-bottom, font-weight是一样的
        font-size: 17px;
        font-weight:400;
        margin-bottom: .75em;
    }
    h2 {
        font-size: 16px;
        font-weight:400;
        margin-bottom: .3em;
    }
    h3 {
        font-weight:400;
        font-size: 15px;
    }
    * {
        max-width: 100%;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        word-wrap: break-word;                  // 文章内容断行, 比较好看
    }
    p {
        margin: 10px 0;                         // 段落的上下间距使用10px
    }
}
```

### 3.7.2 消息通知: msg

效果:

![](/assets/images/weui/weui_msg.png)

代码文件: `style/widget/weui_page/weui_msg.less`

```
@import "../../base/fn";
@import "../weui_button/weui_button";

.weui_msg {
    padding-top: @weuiMsgPaddingTop;
    text-align: center;                 // 所有内容都是居中的, 不同的地方是: font-size、margin-bottom、color

    .weui_icon_area {
        margin-bottom: @weuiMsgIconGap;
    }

    .weui_text_area {
        margin-bottom: @weuiMsgTextGap;
        padding:0 20px;
    }
    .weui_msg_title {
        margin-bottom: @weuiMsgTitleGap;
        font-weight: 400;
        font-size: 20px;
    }
    .weui_msg_desc {
        font-size: 14px;
        color: @globalTextColor;
    }

    .weui_opr_area {
        margin-bottom: @weuiMsgOprGap;
    }

    .weui_extra_area {
        margin-bottom: @weuiMsgExtraAreaGap;
        font-size: 14px;
        color: @globalTextColor;
        a{color: @globalLinkColor;}
    }
}

@media screen and (min-height: @weuiMsgExtraAreaOfMinHeight) {      // 底部信息, 如果屏幕太小,就使用fixd布局,保证一定会展示
    .weui_extra_area {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        text-align: center;
    }
}
```


## 3.8 panel模块
面板

效果:

![](/assets/images/weui/weui_panel.png)

代码文件: `style/widget/weui_panel/weui_panel.css`

```
@import "../../base/fn";

@lineColor: #E5E5E5;
@grayColor: #999999;

/* panel布局结构
weui_panel
    weui_panel_hd
    weui_panel_bd
    weui_panel_ft
*/
.weui_panel {
    background-color: #FFFFFF;
    margin-top: 10px;           // panel之间保证10px的间距
    &:first-child {             // 第1个panel紧邻着上面的元素
        margin-top: 0;
    }

    position: relative;
    overflow: hidden;
    &:before {                  // 每个panel都有topline和bottomline, 而且是顶着屏幕边
        .setTopLine(@lineColor);
    }
    &:after {
        .setBottomLine(@lineColor);
    }
}

.weui_panel_hd {
    padding: 14px 15px 10px;
    color: @grayColor;
    font-size: 13px;
    position: relative;
    &:after {                   // panel header 有bottomline, 所以要注意不要和panel body中的第一个元素的topline重复
        .setBottomLine(@lineColor);
        left: 15px;             // 这条bottomline 要与后面的内容对齐
    }
}

.weui_panel_ft {                // panel footer
    padding: 10px 15px 12px;    // 垂直居中偏上, 看起来比较像一个panel的
    color: @grayColor;          // 文字是灰色,表示没那么重要
    font-size: 14px;
    position: relative;
    &:before {                  // 与上面的panel,用topline隔开
        .setTopLine(@lineColor);
        left: 15px;
    }
    .weui_panel_access & {      // 如果可以点击, 字体用蓝色
        display: block;
        color: #586C94;
        .setTapColor;
        &:active{               // 按下后,背景色加深
            background-color:#ECECEC;
        }
        &:after {               // 生成一个向右的箭头,表示可以点击
            content: " ";
            .setArrow_Wap(right, 6px, #C7C7CC, 2px);
            position: absolute;
            right: 15px;
            top: 50%;
            margin-top: -4px;
        }
    }
}

```


## 3.9 progress模块
进度条

效果:

![](/assets/images/weui/weui_progress.png)

代码文件: `style/widget/weui_progress/weui_progress.css`

```
@import "../../base/fn";
/* 进度条 布局
weui_progress
    weui_progress_bar
        weui_progress_inner_bar
    weui_progress_opr

 */
.weui_progress {    // 使用flex实现进度条
    display: flex;
    align-items: center;
}

.weui_progress_bar {    // 进度条背景, 占满出opr的整行
    background-color: @weuiProgressBg;
    height: @weuiProgressHeight;
    flex: 1;
}

.weui_progress_inner_bar {      // 绿色的进度条, 使用width的百分比表示当前精度
    width: 0;
    height: 100%;
    background-color: @weuiProgressColor;
}

.weui_progress_opr {       // 操作按钮, 如✘号, 与进度条保持15px的距离
    display: block;
    margin-left: 15px;
    font-size: 0;
}
```


## 3.10 searchbar模块
搜素框

效果:

![](/assets/images/weui/weui_searchbar.png)

代码文件: `style/widget/weui_searchbar/weui_searchbar.css`

```
@import "../../base/fn";
/* 搜索条

*/
.weui_search_bar {
    position: relative;
    padding: 8px 10px;
    display: flex;      // 使用flex布局, 占满整行
    box-sizing: border-box;
    background-color: #EFEFF4;  // 用灰色做背景, 与输入框的白色区分
    &:before {                  // topline 和 bottomline
        .setTopLine();
    }
    &:after {
        .setBottomLine();
    }
    &.weui_search_focusing{     // 当鼠标聚焦时, 隐藏"搜索", 显示"取消"
        .weui_search_cancel{
            display: block;
        }
        .weui_search_text{
            display: none;
        }
    }
}
.weui_search_outer {       // 搜索框outer, 白色背景, 带圆角, 边框1px
    position: relative;
    flex: auto;
    background-color: #EFEFF4;
    &:after{
        content: '';
        position: absolute;
        left: 0;
        top:0;
        width: 200%;
        height: 200%;
        transform: scale(.5);
        transform-origin: 0 0;
        border-radius: 10px;
        border: 1px solid #E6E6EA;
        box-sizing: border-box;
        background: #FFFFFF;
    }
}
.weui_search_inner {    // 搜索框inner,
    position: relative;
    padding-left: 30px;
    padding-right: 30px;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    z-index: 1;
    .weui_search_input {    // 实际是一个input输入框
        padding: 4px 0;
        width: 100%;
        height: 20/14em;
        border: 0;
        font-size: 14px;
        line-height: 20/14em;
        box-sizing: content-box;
        background: transparent;
        &:focus {           // 聚焦时, 不要浏览器自带的outline效果
            outline: none;
        }
    }
    .weui_icon_search {     // 搜索按钮, 默认居左
        position: absolute;
        left: 10px;
        top: -2px;
        line-height: 28px;
    }
    .weui_icon_clear {      // 清除按钮, 默认居右
        position: absolute;
        top: -2px;
        right: 0;
        padding: 0 10px;
        line-height: 28px;
    }
}
.weui_search_text {         // 搜索框内的文字, 默认灰色, 居中
    position: absolute;
    top: 1px;
    right: 1px;
    bottom: 1px;
    left: 1px;
    z-index: 2;
    border-radius: 3px;
    text-align: center;
    color: #9B9B9B;
    background: #FFFFFF;
    span {
        display: inline-block;
        font-size: 14px;
        vertical-align: middle;
    }
    .weui_icon_search {
        margin-right: 5px;  // 输入的文字要与搜索图标距离5px
    }
}
.weui_search_cancel {       // "取消"文字, 与左边的框要与一点距离, 显示绿色, 默认不显示
    display: none;          // 只有在搜索框focus的时候才显示
    margin-left: 10px;
    line-height: 28px;
    white-space: nowrap;
    color: #09BB07;
}
.weui_search_input:not(:valid) ~ .weui_icon_clear { // 搜索框没有文字的时候, 不显示✘按钮
    display: none;
}

//干掉input[search]默认的clear button
input[type="search"]::-webkit-search-decoration,
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-results-button,
input[type="search"]::-webkit-search-results-decoration {
    display: none;
}
```

使搜索框产生动态效果,还需添加额外的js代码, 在example.js我们能找到:

```
$('#container').on('focus', '#search_input', function () {
    var $weuiSearchBar = $('#search_bar');
    $weuiSearchBar.addClass('weui_search_focusing');
}).on('blur', '#search_input', function () {        // 当blur在当前的搜索框上时, 如果有内容, 则隐藏搜索图标和"搜索"文字, 如果还没有输入内容, 则显示它们
    var $weuiSearchBar = $('#search_bar');
    $weuiSearchBar.removeClass('weui_search_focusing');
    if ($(this).val()) {
        $('#search_text').hide();
    } else {
        $('#search_text').show();
    }
}).on('input', '#search_input', function () {   // 点击搜索输入框时, 如果有输入内容,直接显示#search_show列表内容, 如果没有则隐藏
    var $searchShow = $("#search_show");        // 模拟动态搜索框效果
    if ($(this).val()) {
        $searchShow.show();
    } else {
        $searchShow.hide();
    }
}).on('touchend', '#search_cancel', function () {   // 点击"取消"时, 隐藏#search_show列表内容, 清空搜索框
    $("#search_show").hide();
    $('#search_input').val('');
}).on('touchend', '#search_clear', function () {    // 点击清除按钮时, 隐藏#search_show列表内容, 清空搜索框
    $("#search_show").hide();
    $('#search_input').val('');
});
```

## 3.11 tab模块
tab有2种:顶部切换面板navbar、 底部导航面板tabbar。

### 3.11.1 tab模块的整体布局

代码文件: `style/widget/weui_tab/weui_tab.css`

```
@import "../../base/fn";
@import "tabbar";
@import "navbar";

/* weui_tab 布局
1) 顶部选项卡navbar
weui_tab
    weui_navbar
        weui_navbar_item weui_bar_item_on
        weui_navbar_item
        ...
    weui_tab_bd
        content
        
2) 底部导航栏tabbar
weui_tab
    weui_tab_bd
        content
    weui_tabbar
        weui_tabbar_item weui_bar_item_on
        weui_tabbar_item
        ...
*/

.weui_tab {         // weui_tab是container的直接子div, 占满整个屏幕
    position: relative;
    height: 100%;
}

.weui_tab_bd {              // tab body 中的内容
    box-sizing: border-box;
    height: 100%;               // 占满整屏
    padding-bottom: 55px;       // 距离底部55px, 防止被底部导航tabbar覆盖
    overflow: auto;             // 根据内容决定是否出现导航条
    -webkit-overflow-scrolling: touch;  // 激发手机的touch滑动属性, 滑动更流畅
}

.weui_tab_bd_item {
    display: none;
}

.weui_tab_bd_item_active {
    display: block;
} 
```

### 3.11.2 顶部切换面板navbar

效果:

![](/assets/images/weui/navbar.png)

代码文件: `style/widget/weui_panel/weui_panel.css`

```
@import "../../base/fn";

.weui_navbar {          // 顶部选项卡navbar
    display: flex;          // 使用flex实现
    position: absolute;
    z-index: 500;
    top: 0;                 // 显示在顶部
    width: 100%;
    background-color: #fafafa;  // 背景默认为浅灰色

    &:after {                   // 都有bottomline, 保证navbar和下面的内容有分隔开
        .setBottomLine(@globalBorderColor);
    }

    & + .weui_tab_bd {          //  内容区域, 距离上方50px, 防止被navbar遮住
        padding-top: 50px;
        padding-bottom: 0;
    }
}

.weui_navbar_item {         // navbar 的每个选项卡
    position: relative;
    display: block;
    flex: 1;                // flex:1, 表示均等平分
    padding: 13px 0;        // 保证水平和垂直居中
    text-align: center;
    font-size: 15px;
    -webkit-tap-highlight-color: transparent;

    &:active {              // 按下时变暗
        background-color: #ededed;
    }

    &.weui_bar_item_on {        // 当前被选中的比其它的背景色暗, 方便区分
        background-color: #eaeaea;
    }

    &:after {                   // 标签之间有一个右分割线
        .setRightLine(#cccccc);
    }

    &:last-child {              // 防止最后一个出现分割线
        &:after {
            display: none;
        }
    }
}
```

### 3.11.3 底部导航面板tabbar

效果:

![](/assets/images/weui/tabbar.png)

代码文件: `style/widget/weui_tab/weui_tabbar.css`

```
@import "../../base/fn";

.weui_tabbar {           // 底部导航tabbar
    display: flex;      // 使用flex布局实现均等切分
    position: absolute;
    z-index: 500;
    bottom: 0;              // 在页面底部, 占满整行, 颜色比背景色略暗, 用以区分导航栏
    width: 100%;
    background-color: #f7f7fa;

    &:before {              // 用一个topline与页面其它内容分隔开
        .setTopLine(#979797);
    }
}

.weui_tabbar_item {
    display: block;
    flex: 1;                 // flex:1 表示各个item均分导航栏
    padding: 7px 0 0;        // 距离顶部7px, 防止紧贴导航栏
    -webkit-tap-highlight-color: transparent;

    &.weui_bar_item_on {        // 当前选中的导航项,字体是绿色高亮的。
        .weui_tabbar_label {
            color: #09BB07;
        }
    }
}

.weui_tabbar_icon {           // 导航选项卡中的图标, 居中,
                              // 不用设置margin top bottom, 因为分别由weui_tabbar_item的padding
                              // 和weui_tabbar_label的margin-top保证了
    margin: 0 auto;
    width: 24px;
    height: 24px;

    img {
        display: block;
        width: 100%;
        height: 100%;
    }

    & + .weui_tabbar_label {
        margin-top: 5px;
    }
}

.weui_tabbar_label {            // 文本居中, 未选中的导航选项卡文字为灰黑色
    text-align: center;
    color: @globalTextColor;
    font-size: 12px;
}
```

## 3.12 tips模块

### 3.12.1 上拉弹出框: actionsheet
通过translate, 将元素移动到屏幕外。 设置transition, 产生弹出效果。

效果:

![](/assets/images/weui/actionsheet.png)

代码文件: `style/widget/weui_tips/weui_actionsheet.less`

```
@import "../../base/fn";
@bgColor:#ECECEC;
/*  上拉弹出框actionsheet
*/
.weui_actionsheet {     // 通过translate, 将元素移动到屏幕外。 设置transition, 产生弹出效果。
    position: fixed;        // 绝对定位,
    left: 0;
    bottom: 0;
    transform: translate(0, 100%);  //  从左侧移动 0 像素，从顶端移动 100%。
    backface-visibility: hidden;
    z-index: 5000;
    width: 100%;
    background-color: @pageDefaultBackgroundColor;
    //slide up animation
    transition: transform .3s;
}
.weui_actionsheet_menu{     // 弹出模块的菜单部分: 示例菜单
    background-color: #FFFFFF;
}
.weui_actionsheet_action {  // 弹出模块的动作部分: 取消
    margin-top: 6px;
    background-color: #FFFFFF;
}
.weui_actionsheet_cell {    // 弹出菜单的每一栏, 上下内间距10px, 字号略大
    position: relative;
    padding: 10px 0;
    text-align: center;
    font-size: 18px;
    &:before {              // 都有topline分割
        .setTopLine(@weuiCellBorderColor);
    }
    &:active{               // 按下后会变暗
        background-color: @bgColor;
    }
    &:first-child{          // 第一个cell的topline不需要
        &:before{
            display: none;
        }
    }
}

//actionSheet aniamtion
.weui_actionsheet_toggle{
    transform: translate(0, 0); // 回到原位
}
```


### 3.12.2 dialog 

效果:

![](/assets/images/weui/dialog.png)

代码文件: `style/widget/weui_tips/weui_dialog.less`

```
@import "../../base/fn";

@weuiDialogBackgroundColor: #FAFAFC;
@weuiDialogLineColor: #D5D5D6;
@weuiDialogLinkColor: #3CC51F;
@weuiDialogLinkActiveBc: #EEEEEE;

.weui_dialog {
    position: fixed;        // 使用绝对定位
    z-index: 5000;          //  确保位于屏幕最顶端
    width: 85%;
    top: 50%;               // 这3行保证居中
    left: 50%;
    transform: translate(-50%, -50%);

    background-color: @weuiDialogBackgroundColor;   // 白色背景, 居中, 圆角
    text-align: center;
    border-radius: 3px;
    overflow: hidden;
    .weui_dialog_confirm & {            // 确认框
        .weui_dialog_hd {
            padding: 1.2em 20px .5em;
        }
        .weui_dialog_bd {               // 提示消息, 靠左对齐
            text-align: left;
        }
    }
}

.weui_dialog_hd {                   // 标题居中, padding 略大,且 上面的padding大于下面的, 看着比较舒服
    padding: 1.2em 0 .5em;
}

.weui_dialog_title {                 // 标题加粗加大
    font-weight: 400;
    font-size: 17px;
}

.weui_dialog_bd {                   // padding 和文字都 略小一些
    padding: 0 20px;
    font-size: 15px;
    color: @globalTextColor;        // 文字是灰色, 表示不怎么重要
    word-wrap: break-word;          // 换行
    word-break: break-all;
}

.weui_dialog_ft {                   // footer 用flex实现, 方便确认取消按钮均分
    position: relative;
    line-height: 42px;
    margin-top: 20px;
    font-size: 17px;
    display: flex;
    a {                             // a表现作为按钮,均分, 并设置按下的高亮效果
        display: block;
        flex: 1;
        color: @weuiDialogLinkColor;
        text-decoration: none;
        .setTapColor;
        &:active {
            background-color: @weuiDialogLinkActiveBc;
        }
    }
    &:after {                       // 设置topline分割线
        content: " ";
        .setTopLine(@weuiDialogLineColor);
    }
    .weui_dialog_confirm & {        // 如果是确认取消2个选项, 中间生成一条分割线
        a {
            position: relative;
            &:after {
                content: " ";
                .setLeftLine(@weuiDialogLineColor);
            }
            &:first-child {
                &:after {
                    display: none;
                }
            }
        }
    }
}

.weui_btn_dialog {              // default 和 primary 2 中类型的按钮颜色不同, 起引导作用
    &.default {
        color: #353535;
    }
    &.primary {
        color: #0BB20C;
    }
}

@media screen and (min-width: 1024px) {         // 如果屏幕过大, 应该保证dialog小一些,否则看着很怪。
    .weui_dialog {
        width: 35%;
    }
}

```


### 3.12.3 蒙版mask 

代码文件: `style/widget/weui_tips/weui_mask.less`

```
@import "../../base/fn";

/* 蒙版mask
*/
.weui_mask {                // 半透明模板
    position: fixed;        // 使用fixed布局,占满全屏
    z-index: 1000;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: rgba(0, 0, 0, .6);      // 颜色是黑色的半透明
}

.weui_mask_transparent {        // 透明的模板
    position: fixed;
    z-index: 1000;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
}

.weui_mask_transition{      // 从 显示半透明 渐变到 透明(不显示), 增加视觉效果
    display: none;
    position: fixed;
    z-index: 1000;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: rgba(0,0,0,0);
    transition:background .3s;
}
.weui_fade_toggle{          // 从 不显示 到 显示成半透明
    background: rgba(0,0,0,.6);
}
```
使蒙版生效,需要添加额外的js代码, 下面是actionsheet中的示例:

显示: `$("#mask").show().addClass('weui_fade_toggle')`

隐藏: `$("#mask").hide().removeClass('weui_fade_toggle')`

```
$('#container').on('click', '#showActionSheet', function () {
    var mask = $('#mask');
    var weuiActionsheet = $('#weui_actionsheet');
    weuiActionsheet.addClass('weui_actionsheet_toggle');
    mask.show()
        .focus()//加focus是为了触发一次页面的重排(reflow or layout thrashing),使mask的transition动画得以正常触发
        .addClass('weui_fade_toggle').one('click', function () {
        hideActionSheet(weuiActionsheet, mask);
    });
    $('#actionsheet_cancel').one('click', function () {
        hideActionSheet(weuiActionsheet, mask);
    });
    mask.unbind('transitionend').unbind('webkitTransitionEnd');

    function hideActionSheet(weuiActionsheet, mask) {
        weuiActionsheet.removeClass('weui_actionsheet_toggle');
        mask.removeClass('weui_fade_toggle');
        mask.on('transitionend', function () {
            mask.hide();
        }).on('webkitTransitionEnd', function () {
            mask.hide();
        })
    }
});
```


### 3.12.4 toast提示 

利用css3的keyframe和transform实现了菊花转圈圈的效果, 挺有意思。

效果:

![](/assets/images/weui/toast.png)

![](/assets/images/weui/toast_loading.png)

代码文件: `style/widget/weui_tips/weui_toast.less`

```
@import "../../base/fn";

/* 两种toast提示
打钩的和转圈圈的
*/

.weui_toast {           // 使用fixed布局,保证弹出在屏幕中央
    position: fixed;
    z-index: 50000;
    width: 7.6em;
    min-height: 7.6em;
    top: 180px;       // 距离顶部180px, 并非完全垂直居中
    left: 50%;        // 用left和margin-left:保证居中
    margin-left: -3.8em;
    background: rgba(40, 40, 40, 0.75);     // 背景黑色半透明, 前景白色
    text-align: center;
    border-radius: 5px;           // 弹出框有一些圆角
    color: #FFFFFF;
}
.weui_icon_toast {        // 弹出框内的图标
    margin: 22px 0 0;
    display: block;
    &:before {
        content: '\EA08';
        color: #FFFFFF;
        font-size: 55px;
    }
}
.weui_toast_content {     // 弹出框内的文字
    margin: 0 0 15px;
}

// loading toast
.weui_loading_toast{     // 转圈圈的toast
    .weui_toast_content{
      margin-top:64%;
      font-size:14px;
    }
}
.weui_loading{          // loading 整体div
    position: absolute;
    width: 0px;
    z-index: 1;
    left: 50%;
    top: 38%;
}
.weui_loading_leaf{     // 圈圈上的每一个小矩形叶子
    position: absolute;
    top: -1px;            // 整体半透明, 并且有一些阴影
    opacity: 0.25;
    &:before{
        content:" ";
        position: absolute;
        width: 8.14px;
        height: 3.08px;
        background: rgb(209, 209, 213);
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px;
        border-radius: 1px;
        transform-origin: left 50% 0px;
    }
    &_0{                            // 每片叶子的位置不一样, 形成一个圆圈, 起始透明时间不一样, 所以看起来像在转
        animation: opacity-60-25-0-12 1.25s linear infinite;
        &:before{
            transform: rotate(0deg) translate(7.92px, 0px);
        }
    }
    &_1{
        animation: opacity-60-25-1-12 1.25s linear infinite;
        &:before{
            transform: rotate(30deg) translate(7.92px, 0px);
        }
    }
    &_2{
        animation: opacity-60-25-2-12 1.25s linear infinite;
        &:before{
            transform: rotate(60deg) translate(7.92px, 0px);
        }
    }
    &_3{
        animation: opacity-60-25-3-12 1.25s linear infinite;
        &:before{
            transform: rotate(90deg) translate(7.92px, 0px);
        }
    }
    &_4{
        animation: opacity-60-25-4-12 1.25s linear infinite;
        &:before{
            transform: rotate(120deg) translate(7.92px, 0px);
        }
    }
    &_5{
        animation: opacity-60-25-5-12 1.25s linear infinite;
        &:before{
            transform: rotate(150deg) translate(7.92px, 0px);
        }
    }
    &_6{
        animation: opacity-60-25-6-12 1.25s linear infinite;
        &:before{
            transform: rotate(180deg) translate(7.92px, 0px);
        }
    }
    &_7{
        animation: opacity-60-25-7-12 1.25s linear infinite;
        &:before{
            transform: rotate(210deg) translate(7.92px, 0px);
        }
    }
    &_8{
        animation: opacity-60-25-8-12 1.25s linear infinite;
        &:before{
            transform: rotate(240deg) translate(7.92px, 0px);
        }
    }
    &_9{
        animation: opacity-60-25-9-12 1.25s linear infinite;
        &:before{
            transform: rotate(270deg) translate(7.92px, 0px);
        }
    }
    &_10{
        animation: opacity-60-25-10-12 1.25s linear infinite;
        &:before{
            transform: rotate(300deg) translate(7.92px, 0px);
        }
    }
    &_11{
        animation: opacity-60-25-11-12 1.25s linear infinite;
        &:before{
            transform: rotate(330deg) translate(7.92px, 0px);
        }
    }
}
@-webkit-keyframes opacity-60-25-0-12 {
  0% { opacity: 0.25; }
  0.01% { opacity: 0.25; }
  0.02% { opacity: 1; }
  60.01% { opacity: 0.25; }
  100% { opacity: 0.25; }
}@-webkit-keyframes opacity-60-25-1-12 {
  0% { opacity: 0.25; }
  8.34333% { opacity: 0.25; }
  8.35333% { opacity: 1; }
  68.3433% { opacity: 0.25; }
  100% { opacity: 0.25; }
}@-webkit-keyframes opacity-60-25-2-12 {
  0% { opacity: 0.25; }
  16.6767% { opacity: 0.25; }
  16.6867% { opacity: 1; }
  76.6767% { opacity: 0.25; }
  100% { opacity: 0.25; }
}@-webkit-keyframes opacity-60-25-3-12 {
  0% { opacity: 0.25; }
  25.01% { opacity: 0.25; }
  25.02% { opacity: 1; }
  85.01% { opacity: 0.25; }
  100% { opacity: 0.25; }
}@-webkit-keyframes opacity-60-25-4-12 {
  0% { opacity: 0.25; }
  33.3433% { opacity: 0.25; }
  33.3533% { opacity: 1; }
  93.3433% { opacity: 0.25; }
  100% { opacity: 0.25; }
}@-webkit-keyframes opacity-60-25-5-12 {
  0% { opacity: 0.270958333333333; }
  41.6767% { opacity: 0.25; }
  41.6867% { opacity: 1; }
  1.67667% { opacity: 0.25; }
  100% { opacity: 0.270958333333333; }
}@-webkit-keyframes opacity-60-25-6-12 {
  0% { opacity: 0.375125; }
  50.01% { opacity: 0.25; }
  50.02% { opacity: 1; }
  10.01% { opacity: 0.25; }
  100% { opacity: 0.375125; }
}@-webkit-keyframes opacity-60-25-7-12 {
  0% { opacity: 0.479291666666667; }
  58.3433% { opacity: 0.25; }
  58.3533% { opacity: 1; }
  18.3433% { opacity: 0.25; }
  100% { opacity: 0.479291666666667; }
}@-webkit-keyframes opacity-60-25-8-12 {
  0% { opacity: 0.583458333333333; }
  66.6767% { opacity: 0.25; }
  66.6867% { opacity: 1; }
  26.6767% { opacity: 0.25; }
  100% { opacity: 0.583458333333333; }
}@-webkit-keyframes opacity-60-25-9-12 {
  0% { opacity: 0.687625; }
  75.01% { opacity: 0.25; }
  75.02% { opacity: 1; }
  35.01% { opacity: 0.25; }
  100% { opacity: 0.687625; }
}@-webkit-keyframes opacity-60-25-10-12 {
  0% { opacity: 0.791791666666667; }
  83.3433% { opacity: 0.25; }
  83.3533% { opacity: 1; }
  43.3433% { opacity: 0.25; }
  100% { opacity: 0.791791666666667; }
}@-webkit-keyframes opacity-60-25-11-12 {
  0% { opacity: 0.895958333333333; }
  91.6767% { opacity: 0.25; }
  91.6867% { opacity: 1; }
  51.6767% { opacity: 0.25; }
  100% { opacity: 0.895958333333333; }
}

```

# 4 结语

重点是: flex布局瓜分行, after、before生成线, 重写表单原生样式。

TODO:  未完善。